# ğŸ® Survivor Game - Cloudflare Workers å¤šäººä¼ºæœå™¨

åŸºæ–¼ Cloudflare Workers + Durable Objects çš„é«˜æ€§èƒ½å¤šäººéŠæˆ²ä¼ºæœå™¨ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´
```bash
cd cloudflare-workers
npm install
```

### 2. è¨­ç½® Cloudflare Workers
1. è¨»å†Š [Cloudflare Workers](https://workers.cloudflare.com/)
2. ç™»å…¥ Cloudflare å¸³æˆ¶ï¼š
```bash
npx wrangler login
```

### 3. éƒ¨ç½²åˆ° Cloudflare
```bash
# é–‹ç™¼ç’°å¢ƒæ¸¬è©¦
npm run dev

# éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
npm run deploy
```

### 4. æ›´æ–°å®¢æˆ¶ç«¯é…ç½®
éƒ¨ç½²å®Œæˆå¾Œï¼Œæ›´æ–° `js/systems/MultiplayerSystem.js` ä¸­çš„ä¼ºæœå™¨ URLï¼š
```javascript
this.serverUrl = 'https://your-worker.your-subdomain.workers.dev';
```

## ğŸ“‹ åŠŸèƒ½ç‰¹è‰²

### ğŸŒ ç¶²è·¯æ¶æ§‹
- **æ¬Šå¨ä¼ºæœå™¨**ï¼šæ‰€æœ‰éŠæˆ²é‚è¼¯åœ¨ä¼ºæœå™¨ç«¯åŸ·è¡Œ
- **60 FPS éŠæˆ²å¾ªç’°**ï¼šå¹³æ»‘çš„éŠæˆ²é«”é©—
- **ç‹€æ…‹åŒæ­¥**ï¼šå¯¦æ™‚åŒæ­¥ç©å®¶ã€æ•µäººã€å°„å½ˆç‹€æ…‹
- **è¼¸å…¥é æ¸¬**ï¼šæ¸›å°‘ç¶²è·¯å»¶é²å½±éŸ¿

### ğŸ¯ éŠæˆ²åŠŸèƒ½
- **å¤šäººæˆ¿é–“ç³»çµ±**ï¼šæœ€å¤š 4 äººåŒæ™‚éŠæˆ²
- **æ­¦å™¨ç³»çµ±**ï¼šMagic Missile + Aiming Bolt
- **æ•µäºº AI**ï¼šè‡ªå‹•è¿½è¹¤æœ€è¿‘ç©å®¶
- **ç¶“é©—å€¼ç³»çµ±**ï¼šæ“Šæ®ºæ•µäººç²å¾— XP
- **ç¢°æ’æª¢æ¸¬**ï¼šç²¾ç¢ºçš„åœ“å½¢ç¢°æ’

### ğŸ”’ å®‰å…¨ç‰¹æ€§
- **é˜²ä½œå¼Š**ï¼šæ‰€æœ‰è¨ˆç®—åœ¨ä¼ºæœå™¨ç«¯
- **è¼¸å…¥é©—è­‰**ï¼šé˜²æ­¢ç„¡æ•ˆè¼¸å…¥
- **åºåˆ—è™ŸåŒæ­¥**ï¼šé˜²æ­¢é‡æ’­æ”»æ“Š

## ğŸ› ï¸ API æ–‡æª”

### REST API

#### å‰µå»ºæˆ¿é–“
```
POST /api/create-room
Response: { "roomId": "ABC123", "wsUrl": "wss://..." }
```

#### åŠ å…¥æˆ¿é–“
```
POST /api/join-room
Body: { "roomId": "ABC123" }
Response: { "roomId": "ABC123", "wsUrl": "wss://...", "playerCount": 2 }
```

#### æŸ¥è©¢æˆ¿é–“ç‹€æ…‹
```
GET /api/room-status?roomId=ABC123
Response: { "playerCount": 2, "maxPlayers": 4, "gameStarted": true }
```

### WebSocket API

#### é€£æ¥
```
wss://your-worker.workers.dev?roomId=ABC123&playerId=player_xxx
```

#### è¨Šæ¯æ ¼å¼

**ç©å®¶è¼¸å…¥**
```json
{
  "type": "input",
  "input": {
    "move": { "x": 1, "y": 0 }
  },
  "sequence": 123
}
```

**éŠæˆ²ç‹€æ…‹**
```json
{
  "type": "game_state",
  "sequence": 456,
  "state": {
    "players": { ... },
    "enemies": { ... },
    "projectiles": { ... },
    "xpOrbs": { ... }
  }
}
```

**Ping æ¸¬è©¦**
```json
{
  "type": "ping",
  "timestamp": 1234567890
}
```

## ğŸ—ï¸ æ¶æ§‹èªªæ˜

### Durable Objects
æ¯å€‹éŠæˆ²æˆ¿é–“æ˜¯ä¸€å€‹ç¨ç«‹çš„ Durable Objectï¼š
- **ç‹€æ…‹æŒä¹…åŒ–**ï¼šæˆ¿é–“ç‹€æ…‹è‡ªå‹•ä¿å­˜
- **å…¨çƒåˆ†ä½ˆ**ï¼šå°±è¿‘è·¯ç”±æ¸›å°‘å»¶é²
- **è‡ªå‹•æ“´å±•**ï¼šæŒ‰éœ€å‰µå»º/éŠ·æ¯€æˆ¿é–“

### éŠæˆ²å¾ªç’°
```
æ¯å¹€ (60 FPS):
1. è™•ç†ç©å®¶è¼¸å…¥
2. æ›´æ–°æ­¦å™¨å†·å»
3. ç™¼å°„æ­¦å™¨
4. æ›´æ–°å°„å½ˆä½ç½®
5. ç”Ÿæˆæ•µäºº
6. æ›´æ–°æ•µäºº AI
7. æª¢æŸ¥ç¢°æ’
8. æ¸…ç†éæœŸç‰©ä»¶
9. å»£æ’­éŠæˆ²ç‹€æ…‹
```

### ç‹€æ…‹åŒæ­¥
- **å®¢æˆ¶ç«¯é æ¸¬**ï¼šæœ¬åœ°ç©å®¶ç«‹å³ç§»å‹•
- **ä¼ºæœå™¨ä¿®æ­£**ï¼šæ¬Šå¨ç‹€æ…‹è¦†è“‹é æ¸¬
- **æ’å€¼å¹³æ»‘**ï¼šé ç¨‹ç©å®¶ä½ç½®æ’å€¼

## ğŸ’° æˆæœ¬ä¼°ç®—

### Cloudflare Workers å…è²»é¡åº¦
- **è«‹æ±‚æ¬¡æ•¸**ï¼šæ¯å¤© 100,000 æ¬¡
- **CPU æ™‚é–“**ï¼šæ¯å¤© 10ms x 100,000 = 1000 ç§’
- **Durable Objects**ï¼šæ¯æœˆ 1,000,000 æ¬¡è«‹æ±‚

### é ä¼°ä½¿ç”¨é‡ (4 äººæˆ¿é–“ï¼Œ1 å°æ™‚éŠæˆ²)
- **WebSocket é€£æ¥**ï¼š4 å€‹
- **éŠæˆ²ç‹€æ…‹æ›´æ–°**ï¼š60 FPS Ã· 3 = 20/ç§’
- **ç¸½è«‹æ±‚**ï¼š20 x 3600 x 4 = 288,000 æ¬¡

**çµè«–**ï¼šå…è²»é¡åº¦å¯æ”¯æŒæ¯å¤©ç´„ 8 å°æ™‚çš„ 4 äººéŠæˆ²ã€‚

## ğŸ”§ é–‹ç™¼å·¥å…·

### æœ¬åœ°æ¸¬è©¦
```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# æŸ¥çœ‹ Workers æ—¥èªŒ
npx wrangler tail
```

### èª¿è©¦æŠ€å·§
1. **ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·**ï¼šæŸ¥çœ‹ WebSocket è¨Šæ¯
2. **Cloudflare Dashboard**ï¼šç›£æ§è«‹æ±‚å’ŒéŒ¯èª¤
3. **wrangler tail**ï¼šå¯¦æ™‚æŸ¥çœ‹ä¼ºæœå™¨æ—¥èªŒ

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**é€£æ¥å¤±æ•—**
- æª¢æŸ¥ä¼ºæœå™¨ URL æ˜¯å¦æ­£ç¢º
- ç¢ºèª Workers å·²éƒ¨ç½²æˆåŠŸ
- æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤

**éŠæˆ²ä¸åŒæ­¥**
- æª¢æŸ¥ç¶²è·¯é€£æ¥ç©©å®šæ€§
- ç¢ºèª WebSocket é€£æ¥æ­£å¸¸
- é‡æ–°æ•´ç†é é¢é‡æ–°é€£æ¥

**æˆ¿é–“å‰µå»ºå¤±æ•—**
- æª¢æŸ¥ Cloudflare Workers é…é¡
- ç¢ºèª Durable Objects å·²å•Ÿç”¨
- æŸ¥çœ‹ wrangler éƒ¨ç½²æ—¥èªŒ

## ğŸ”® æœªä¾†æ”¹é€²

### è¨ˆåŠƒåŠŸèƒ½
- [ ] è§€æˆ°æ¨¡å¼
- [ ] æ’è¡Œæ¦œç³»çµ±
- [ ] æ›´å¤šæ­¦å™¨é¡å‹
- [ ] åœ°åœ–ç³»çµ±
- [ ] èªéŸ³èŠå¤©

### æ€§èƒ½å„ªåŒ–
- [ ] ç‹€æ…‹å·®åˆ†åŒæ­¥
- [ ] å®¢æˆ¶ç«¯ç‹€æ…‹å¿«å–
- [ ] å‹•æ…‹è¦–é‡å‰”é™¤
- [ ] è² è¼‰å¹³è¡¡

## ğŸ“ æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹åƒè€ƒï¼š
- [Cloudflare Workers æ–‡æª”](https://developers.cloudflare.com/workers/)
- [Durable Objects æŒ‡å—](https://developers.cloudflare.com/workers/runtime-apis/durable-objects/)
- [WebSocket API](https://developers.cloudflare.com/workers/runtime-apis/websockets/)

---

**äº«å—ä½ çš„å¤šäººç”Ÿå­˜éŠæˆ²ï¼** ğŸ®âœ¨ 